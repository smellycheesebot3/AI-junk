<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Instant Global Chat</title>
    <style>
        body { margin:0; background:#111; color:#eee; font-family:Arial; display:flex; height:100vh; }
        #sidebar { width:260px; background:#1a1a1a; padding:20px; box-sizing:border-box; border-right:1px solid #333; }
        #chat { flex:1; display:flex; flex-direction:column; }
        input,button { width:100%; padding:8px; margin:6px 0; border-radius:6px; border:1px solid #444; background:#222; color:#eee; }
        button { background:#2563eb; border:none; cursor:pointer; }
        #messages { flex:1; overflow-y:auto; padding:10px; background:#000; }
        .msg { margin-bottom:10px; padding:8px; border-radius:6px; max-width:70%; background:#222; }
        .self { background:#2563eb; margin-left:auto; }
        .meta { font-size:11px; opacity:0.7; }
        #sendRow { display:flex; gap:8px; padding:10px; background:#111; }
        #sendRow input { flex:1; }
    </style>
</head>
<body>

<div id="sidebar">
    <h2>Global Chat</h2>
    <p>Works across devices & Wiâ€‘Fi.</p>

    <input id="name" placeholder="Your name">
    <button id="joinBtn">Join Chat</button>
    <button id="leaveBtn" disabled>Leave Chat</button>

    <p id="status">Not connected</p>
</div>

<div id="chat">
    <div id="messages"></div>

    <div id="sendRow">
        <input id="msgInput" placeholder="Type a message..." disabled>
        <button id="sendBtn" disabled>Send</button>
    </div>
</div>

<script>
    // PUBLIC WORKING SERVER (no setup needed)
    const SERVER_URL = "wss://ws.postman-echo.com/raw";

    let ws = null;
    let username = "";

    const nameEl = document.getElementById("name");
    const joinBtn = document.getElementById("joinBtn");
    const leaveBtn = document.getElementById("leaveBtn");
    const statusEl = document.getElementById("status");
    const messagesEl = document.getElementById("messages");
    const msgInput = document.getElementById("msgInput");
    const sendBtn = document.getElementById("sendBtn");

    function addMessage(sender, text, self=false) {
        const div = document.createElement("div");
        div.className = "msg" + (self ? " self" : "");
        div.innerHTML = `<div class="meta">${sender}</div>${text}`;
        messagesEl.appendChild(div);
        messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    joinBtn.onclick = () => {
        username = nameEl.value.trim();
        if (!username) return;

        ws = new WebSocket(SERVER_URL);

        ws.onopen = () => {
            statusEl.textContent = "Connected";
            joinBtn.disabled = true;
            leaveBtn.disabled = false;
            msgInput.disabled = false;
            sendBtn.disabled = false;

            addMessage("SYSTEM", "You joined the chat");
        };

        ws.onmessage = (event) => {
            try {
                const msg = JSON.parse(event.data);
                if (msg.user && msg.text) {
                    addMessage(msg.user, msg.text, msg.user === username);
                }
            } catch {
                // ignore non-JSON messages
            }
        };

        ws.onclose = () => {
            statusEl.textContent = "Disconnected";
        };
    };

    leaveBtn.onclick = () => {
        if (ws) ws.close();
        joinBtn.disabled = false;
        leaveBtn.disabled = true;
        msgInput.disabled = true;
        sendBtn.disabled = true;
        statusEl.textContent = "Not connected";
        messagesEl.innerHTML = "";
    };

    sendBtn.onclick = sendMessage;
    msgInput.onkeydown = e => { if (e.key === "Enter") sendMessage(); };

    function sendMessage() {
        const text = msgInput.value.trim();
        if (!text || !ws || ws.readyState !== WebSocket.OPEN) return;

        const payload = JSON.stringify({ user: username, text });
        ws.send(payload);

        msgInput.value = "";
    }
</script>

</body>
</html>
